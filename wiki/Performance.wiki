#summary Simple performance measurements on test cases
=Performance=
Performance is important with Lucene. Performance impact of the library can vary, dependent on your infrastructure and data.

There are some parameters, that have great impact:
  * chunk size
  * use of sequential log based writing,
  * transformation algorithms

By default block site is set to 128KB and sequential log based writing. This settings are optimized (when used with compression) for good compression.



==Simple benchmark==

I've made small benchmark based on test case. For each method 20000 documents are inserted into index. Every 10000 documents are separately commited to create multiple segments, then index is optimized  and searched 10000 times. Search results (always two) are retrieved. All measurements are in milliseconds, except size, which is in bytes.

Method description:
  * lucene - lucene without transformation directory
  * lucene null - transformation directory with null transform, eg. just creating chunks
  * compress - transparent compression (size should be smaller)
  * AES encrypted - transparent encryption with AES (128-bits)
  * AES CBC encrypted - transparent encryption with AES CBC (128-bits)
  * Compressed AES CBC encrypted - transparent compression with AES CBC (128-bits) encryption

All operations were repeated 31 times. Data from first run is ommited from statistics. All files were created on ramfs filesystem.

===Notes==
Size can vary of chunked index can vary, dependent on content of data, since CRC is written with writeVLong(). 

Bulk searching for 10000 documents (and loading documents) spends most of the time in memory allocation operations (garbage collection), due to nature of lucene file cloning (eg. allocating and freeing copy of all chunk buffers). Therefore smaller buffer size yields in better search performance, which is not necessary true in real world load.

==Log based writing==

Large chunk size (128k)
||Method||WriterOpen(ms)||Indexing(ms)||Optimization(ms)||Closing(ms)||ReaderOpen(ms)||Single search(ms)||Search(ms)||ReaderClose(ms)||Size(bytes)||
||lucene||1,53+/-1,83||304,57+/-20,63||114,60+/-5,94||0,93+/-0,37||0,47+/-0,51||0,17+/-0,38||132,10+/-6,20||0,07+/-0,25||1788158,00+/-0,00||
||lucene null||1,77+/-0,73||343,77+/-29,47||160,53+/-18,09||1,67+/-0,84||8,20+/-8,91||1,40+/-1,13||2934,70+/-90,83||0,03+/-0,18||1788764,87+/-0,43||
||compressed||1,83+/-0,59||464,53+/-27,66||289,47+/-9,15||1,40+/-1,13||8,03+/-6,63||1,90+/-1,24||2152,27+/-48,01||0,00+/-0,00||183093,00+/-2,05||
||AES encrypted||4,40+/-0,67||462,83+/-19,98||313,63+/-18,10||1,43+/-0,50||23,40+/-9,80||4,77+/-1,41||2820,93+/-93,55||0,17+/-0,38||1789130,93+/-0,25||
||AES CBC encrypted||4,30+/-0,60||481,60+/-15,81||347,77+/-22,83||2,03+/-1,22||21,50+/-6,25||6,13+/-1,93||2784,43+/-52,14||0,17+/-0,38||1789229,97+/-0,18||
||Compressed AES CBC encrypted||4,77+/-0,73||1032,63+/-35,67||1137,10+/-33,71||3,53+/-7,51||22,37+/-14,00||2,53+/-1,55||2132,20+/-68,44||0,13+/-0,35||183405,57+/-6,03||

Smaller chunk size (16k)
||Method||WriterOpen(ms)||Indexing(ms)||Optimization(ms)||Closing(ms)||ReaderOpen(ms)||Single search(ms)||Search(ms)||ReaderClose(ms)||Size(bytes)||
||lucene||1,13+/-0,57||309,30+/-18,93||106,50+/-2,84||1,10+/-0,88||0,40+/-0,50||0,17+/-0,38||139,30+/-11,82||0,07+/-0,25||1788158,00+/-0,00||
||lucene null||1,47+/-1,04||324,80+/-8,88||139,27+/-14,82||1,00+/-0,00||0,90+/-0,31||0,33+/-0,48||617,30+/-15,25||0,03+/-0,18||1790964,83+/-0,38||
||compressed||1,37+/-0,56||422,30+/-14,66||248,37+/-24,73||1,13+/-1,33||1,73+/-1,84||0,67+/-0,48||589,13+/-18,05||0,13+/-0,35||182748,83+/-1,90||
||AES encrypted||3,87+/-0,57||464,13+/-16,11||288,13+/-8,25||1,00+/-0,00||10,03+/-1,25||1,27+/-0,45||630,03+/-11,33||0,00+/-0,00||1792867,87+/-0,43||
||AES CBC encrypted||4,20+/-0,71||493,17+/-19,96||313,10+/-21,72||1,03+/-0,18||11,50+/-7,43||1,57+/-0,50||630,00+/-15,77||0,10+/-0,31||1792966,87+/-0,35||
||Compressed AES CBC encrypted||4,13+/-0,68||787,70+/-27,36||747,77+/-31,71||0,93+/-0,25||9,33+/-0,61||0,70+/-0,47||584,73+/-17,27||0,13+/-0,35||183846,40+/-4,97||

Small chunk size (4k)

||Method||WriterOpen(ms)||Indexing(ms)||Optimization(ms)||Closing(ms)||ReaderOpen(ms)||Single search(ms)||Search(ms)||ReaderClose(ms)||Size(bytes)||
||lucene||1,13+/-0,35||311,23+/-21,17||108,90+/-5,93||0,97+/-0,18||0,37+/-0,49||0,23+/-0,43||139,47+/-7,90||0,13+/-0,35||1788158,00+/-0,00||
||lucene null||1,33+/-1,12||332,30+/-11,40||138,57+/-11,56||1,00+/-0,00||0,77+/-0,43||0,13+/-0,35||392,93+/-19,45||0,03+/-0,18||1797154,97+/-0,18||
||compressed||1,30+/-0,47||435,93+/-21,61||256,60+/-15,16||0,93+/-0,45||0,97+/-0,18||0,30+/-0,47||410,63+/-13,83||0,17+/-0,38||198890,63+/-2,43||
||AES encrypted||3,83+/-0,59||468,07+/-14,20||291,60+/-7,57||1,10+/-0,84||9,47+/-2,06||1,13+/-0,82||406,90+/-9,74||0,07+/-0,25||1804283,93+/-0,25||
||AES CBC encrypted||3,83+/-0,53||486,57+/-12,15||312,63+/-9,14||0,90+/-0,31||9,20+/-0,96||0,97+/-0,18||412,20+/-10,31||0,03+/-0,18||1804382,97+/-0,18||
||Compressed AES CBC encrypted||4,10+/-0,76||582,33+/-18,59||418,40+/-18,27||1,10+/-1,35||9,53+/-1,89||0,43+/-0,50||414,10+/-16,45||0,13+/-0,35||202172,47+/-5,99||

==Transformation after close==
It is possible to trigger transformation after directory file close. Temporary directory files are created without any application of transformation (eg. unencrypted/uncompresed) without chunking. After close operation on file is called, whole file is transformed. File close operations are also called from lucene indexer, therefore transformation can be applied during indexing.

This mode guaranties best read performance, since no chunk is overwritten.

Large chunk size (128k)

||Method||WriterOpen(ms)||Indexing(ms)||Optimization(ms)||Closing(ms)||ReaderOpen(ms)||Single search(ms)||Search(ms)||ReaderClose(ms)||Size(bytes)||
||lucene||1,40+/-1,16||307,30+/-11,10||111,93+/-6,99||1,10+/-0,61||0,60+/-0,50||0,10+/-0,31||129,10+/-5,41||0,03+/-0,18||1788158,00+/-0,00||
||lucene null||1,97+/-0,61||337,90+/-17,57||155,97+/-17,20||1,77+/-0,43||3,10+/-1,24||1,67+/-1,63||2882,30+/-67,34||0,03+/-0,18||1788574,00+/-0,00||
||compressed||2,23+/-0,50||459,40+/-17,24||291,27+/-16,39||2,13+/-1,59||4,50+/-1,50||1,97+/-1,47||2128,10+/-34,17||0,10+/-0,31||182934,33+/-1,63||
||AES encrypted||4,57+/-1,14||466,00+/-20,24||305,80+/-14,87||1,83+/-0,95||18,13+/-7,18||5,90+/-6,54||2785,77+/-74,85||0,07+/-0,25||1788865,97+/-0,18||
||AES CBC encrypted||4,63+/-1,13||485,37+/-18,87||334,47+/-19,09||1,77+/-0,43||18,90+/-2,58||5,13+/-0,51||2794,30+/-45,46||0,10+/-0,31||1788964,87+/-0,35||
||Compressed AES CBC encrypted||5,30+/-1,32||1032,60+/-32,86||1133,53+/-37,77||4,77+/-10,35||14,57+/-6,69||2,73+/-2,15||2115,40+/-57,95||0,07+/-0,25||183187,57+/-5,93||


Smaller chunk(16k)

||Method||WriterOpen(ms)||Indexing(ms)||Optimization(ms)||Closing(ms)||ReaderOpen(ms)||Single search(ms)||Search(ms)||ReaderClose(ms)||Size(bytes)||
||lucene||1,07+/-0,37||306,47+/-13,57||109,10+/-12,40||0,93+/-0,37||0,37+/-0,49||0,37+/-0,96||132,80+/-11,14||0,13+/-0,35||1788158,00+/-0,00||
||lucene null||1,23+/-0,43||324,43+/-8,86||144,70+/-17,44||2,63+/-8,39||0,77+/-0,43||0,23+/-0,43||601,53+/-14,33||0,10+/-0,31||1790775,97+/-0,18||
||compressed||1,53+/-0,51||418,43+/-15,82||244,63+/-11,61||0,93+/-0,37||0,93+/-0,25||0,53+/-0,51||581,53+/-16,68||0,10+/-0,31||182611,27+/-1,96||
||AES encrypted||3,97+/-0,41||459,20+/-17,31||290,83+/-10,11||1,13+/-0,35||9,70+/-1,09||1,20+/-0,41||617,53+/-10,91||0,20+/-0,41||1792603,93+/-0,25||
||AES CBC encrypted||4,10+/-0,55||484,73+/-19,80||312,53+/-11,32||1,07+/-0,25||11,37+/-6,89||2,10+/-1,32||617,23+/-13,40||0,03+/-0,18||1792702,93+/-0,25||
||Compressed AES CBC encrypted||4,23+/-0,57||796,20+/-25,76||739,63+/-30,27||1,10+/-0,31||9,20+/-0,85||0,57+/-0,50||576,77+/-19,71||0,13+/-0,35||183646,50+/-4,81||


=Performance Tip=
If indexing performance is very important you can index directly without transformation. After index is closed, content of directory can be copied from untransformed to transformed index with Lucene's Directory.copy class method.