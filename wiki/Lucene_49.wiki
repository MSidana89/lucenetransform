#summary Changes and performance on upgrade to Lucene 4.9
 
=  Lucene 4.9 changes =

Lucene 4.9 introduces big changes to Directory API, which simplifies implementation of transformation and ensures only sequential writes. Therefore no temporary files and copying is needed. For this reason file format has been changed and current implementation cannot read old files.  
 
= Detailed performance tests =
Chunk size 4k logAppend=true
<table border="1"><tr><th>Method</th><td>WriterOpen(ms)</td><td>Indexing(ms)</td><td>Optimization(ms)</td><td>Closing(ms)</td><td>ReaderOpen(ms)</td><td>Single search(ms)</td><td>Search(ms)</td><td>ReaderClose(ms)</td><td>Size(bytes)</td></tr><tr><td>lucene</td><td>0,50+/-0,51 100,00%+/-203,42%</td><td>145,83+/-18,18 100,00%+/-24,93%</td><td>38,57+/-4,22 100,00%+/-21,86%</td><td>35,00+/-12,85 100,00%+/-73,42%</td><td>2,93+/-0,91 100,00%+/-61,85%</td><td>0,00+/-0,00 NaN%+/-NaN%</td><td>147,30+/-9,03 100,00%+/-12,26%</td><td>1,57+/-0,73 100,00%+/-92,93%</td><td>494780,00+/-0,00 100,00%+/-0,00%</td></tr><tr><td>lucene null</td><td>0,43+/-0,50 86,67%+/-188,95%</td><td>114,23+/-7,37 78,33%+/-14,82%</td><td>45,00+/-3,99 116,68%+/-23,10%</td><td bgcolor="green">1,23+/-0,50 3,52%+/-2,73%</td><td>3,40+/-0,77 115,91%+/-62,10%</td><td>0,00+/-0,00 NaN%+/-NaN%</td><td>185,83+/-7,13 126,16%+/-12,58%</td><td>1,23+/-0,68 78,72%+/-79,91%</td><td>497747,00+/-0,00 100,60%+/-0,00%</td></tr><tr><td>compressed</td><td>0,43+/-0,50 86,67%+/-188,95%</td><td>145,70+/-6,63 99,91%+/-17,00%</td><td>60,87+/-4,30 157,82%+/-28,39%</td><td bgcolor="green">1,47+/-0,57 4,19%+/-3,17%</td><td>3,57+/-0,90 121,59%+/-68,21%</td><td bgcolor="red">0,27+/-0,45 Infinity%+/-NaN%</td><td>187,03+/-8,40 126,97%+/-13,49%</td><td>1,23+/-0,73 78,72%+/-83,04%</td><td bgcolor="green">73095,07+/-1,23 14,77%+/-0,00%</td></tr><tr><td>AES encrypted</td><td>0,33+/-0,48 66,67%+/-163,70%</td><td>139,30+/-6,13 95,52%+/-16,11%</td><td>57,17+/-4,24 148,23%+/-27,18%</td><td bgcolor="green">1,20+/-0,55 3,43%+/-2,83%</td><td bgcolor="red">23,17+/-2,61 789,77%+/-333,37%</td><td bgcolor="red">0,10+/-0,31 Infinity%+/-NaN%</td><td>181,47+/-4,92 123,20%+/-10,89%</td><td>1,30+/-0,84 82,98%+/-91,96%</td><td>499930,00+/-0,00 101,04%+/-0,00%</td></tr><tr><td>AES CBC encrypted</td><td>0,43+/-0,50 86,67%+/-188,95%</td><td>141,77+/-7,61 97,21%+/-17,33%</td><td>57,83+/-5,81 149,96%+/-31,45%</td><td bgcolor="green">1,20+/-0,55 3,43%+/-2,83%</td><td bgcolor="red">23,33+/-2,06 795,45%+/-316,12%</td><td bgcolor="red">0,10+/-0,31 Infinity%+/-NaN%</td><td>181,80+/-6,59 123,42%+/-12,04%</td><td>1,20+/-0,76 76,60%+/-84,17%</td><td>500325,97+/-0,18 101,12%+/-0,00%</td></tr><tr><td>Compressed AES CBC encrypted</td><td>0,27+/-0,45 53,33%+/-144,20%</td><td>172,17+/-6,81 118,06%+/-19,38%</td><td bgcolor="red">84,60+/-5,38 219,36%+/-37,93%</td><td bgcolor="green">1,37+/-0,56 3,90%+/-3,02%</td><td bgcolor="red">23,50+/-1,81 801,14%+/-309,63%</td><td bgcolor="red">0,07+/-0,25 Infinity%+/-NaN%</td><td>184,27+/-8,41 125,10%+/-13,38%</td><td>1,13+/-0,68 72,34%+/-77,11%</td><td bgcolor="green">74638,97+/-0,18 15,09%+/-0,00%</td></tr></table>
Chunk size 16k logAppend=true
<table border="1"><tr><th>Method</th><td>WriterOpen(ms)</td><td>Indexing(ms)</td><td>Optimization(ms)</td><td>Closing(ms)</td><td>ReaderOpen(ms)</td><td>Single search(ms)</td><td>Search(ms)</td><td>ReaderClose(ms)</td><td>Size(bytes)</td></tr><tr><td>lucene</td><td>0,40+/-0,50 100,00%+/-249,14%</td><td>142,57+/-6,62 100,00%+/-9,28%</td><td>36,53+/-2,57 100,00%+/-14,07%</td><td>31,10+/-2,54 100,00%+/-16,32%</td><td>1,50+/-0,63 100,00%+/-83,96%</td><td>0,07+/-0,25 100,00%+/-761,12%</td><td>146,27+/-7,60 100,00%+/-10,39%</td><td>1,60+/-0,72 100,00%+/-90,50%</td><td>494780,00+/-0,00 100,00%+/-0,00%</td></tr><tr><td>lucene null</td><td>0,43+/-0,50 108,33%+/-260,95%</td><td>111,13+/-6,18 77,95%+/-7,95%</td><td>42,43+/-3,24 116,15%+/-17,05%</td><td bgcolor="green">0,93+/-0,25 3,00%+/-1,06%</td><td>2,33+/-0,48 155,56%+/-97,27%</td><td bgcolor="red">0,20+/-0,41 300,00%+/-1751,94%</td><td>233,53+/-9,79 159,66%+/-14,99%</td><td bgcolor="green">0,73+/-0,45 45,83%+/-48,85%</td><td>496046,97+/-0,18 100,26%+/-0,00%</td></tr><tr><td>compressed</td><td>0,57+/-0,50 141,67%+/-302,47%</td><td>133,73+/-4,27 93,80%+/-7,35%</td><td>59,53+/-6,03 162,96%+/-27,96%</td><td bgcolor="green">1,30+/-0,53 4,18%+/-2,06%</td><td>3,00+/-0,53 200,00%+/-118,98%</td><td bgcolor="red">0,63+/-0,49 950,00%+/-4350,54%</td><td>229,57+/-17,54 156,95%+/-20,14%</td><td>0,93+/-0,58 58,33%+/-62,85%</td><td bgcolor="green">56819,60+/-1,45 11,48%+/-0,00%</td></tr><tr><td>AES encrypted</td><td>0,40+/-0,50 100,00%+/-249,14%</td><td>134,97+/-6,34 94,67%+/-8,84%</td><td>54,10+/-3,03 148,08%+/-18,72%</td><td bgcolor="green">0,93+/-0,37 3,00%+/-1,42%</td><td bgcolor="red">21,50+/-3,28 1433,33%+/-820,23%</td><td bgcolor="red">0,17+/-0,38 250,00%+/-1519,98%</td><td>225,97+/-11,52 154,49%+/-15,90%</td><td bgcolor="green">0,77+/-0,50 47,92%+/-53,18%</td><td>496777,90+/-0,31 100,40%+/-0,00%</td></tr><tr><td>AES CBC encrypted</td><td>0,37+/-0,49 91,67%+/-236,72%</td><td>135,73+/-5,39 95,21%+/-8,20%</td><td>54,37+/-2,72 148,81%+/-17,92%</td><td bgcolor="green">0,97+/-0,18 3,11%+/-0,84%</td><td bgcolor="red">22,83+/-3,36 1522,22%+/-863,32%</td><td>0,13+/-0,35 200,00%+/-1279,74%</td><td>227,80+/-7,97 155,74%+/-13,54%</td><td bgcolor="green">0,73+/-0,45 45,83%+/-48,85%</td><td>497175,90+/-0,31 100,48%+/-0,00%</td></tr><tr><td>Compressed AES CBC encrypted</td><td>0,30+/-0,47 75,00%+/-209,95%</td><td>167,40+/-4,69 117,42%+/-8,74%</td><td bgcolor="red">117,77+/-2,27 322,35%+/-28,88%</td><td bgcolor="green">1,17+/-0,46 3,75%+/-1,79%</td><td bgcolor="red">23,60+/-1,92 1573,33%+/-788,69%</td><td bgcolor="red">0,27+/-0,45 400,00%+/-2196,91%</td><td>229,57+/-8,69 156,95%+/-14,09%</td><td bgcolor="green">0,50+/-0,51 31,25%+/-45,92%</td><td bgcolor="green">57324,97+/-0,18 11,59%+/-0,00%</td></tr></table>
Chunk size 128k logAppend=true
<table border="1"><tr><th>Method</th><td>WriterOpen(ms)</td><td>Indexing(ms)</td><td>Optimization(ms)</td><td>Closing(ms)</td><td>ReaderOpen(ms)</td><td>Single search(ms)</td><td>Search(ms)</td><td>ReaderClose(ms)</td><td>Size(bytes)</td></tr><tr><td>lucene</td><td>0,37+/-0,49 100,00%+/-267,35%</td><td>142,17+/-9,17 100,00%+/-12,90%</td><td>38,57+/-4,30 100,00%+/-22,28%</td><td>33,13+/-10,70 100,00%+/-64,60%</td><td>1,47+/-0,63 100,00%+/-85,75%</td><td>0,13+/-0,35 100,00%+/-518,62%</td><td>148,03+/-8,42 100,00%+/-11,37%</td><td>1,90+/-0,92 100,00%+/-97,15%</td><td>494780,00+/-0,00 100,00%+/-0,00%</td></tr><tr><td>lucene null</td><td>0,30+/-0,47 81,82%+/-236,48%</td><td>111,93+/-7,63 78,73%+/-10,45%</td><td>43,50+/-3,72 112,79%+/-22,21%</td><td bgcolor="green">1,10+/-0,40 3,32%+/-2,29%</td><td bgcolor="red">3,63+/-0,49 247,73%+/-139,63%</td><td bgcolor="green">0,03+/-0,18 25,00%+/-201,76%</td><td bgcolor="red">438,83+/-12,39 296,44%+/-25,23%</td><td bgcolor="green">0,43+/-0,50 22,81%+/-37,60%</td><td>495481,93+/-0,25 100,14%+/-0,00%</td></tr><tr><td>compressed</td><td bgcolor="green">0,17+/-0,38 45,45%+/-164,14%</td><td>140,60+/-6,63 98,90%+/-11,04%</td><td>62,47+/-7,62 161,97%+/-37,81%</td><td bgcolor="green">1,40+/-0,50 4,23%+/-2,87%</td><td bgcolor="red">5,40+/-0,62 368,18%+/-200,22%</td><td>0,17+/-0,38 125,00%+/-608,42%</td><td bgcolor="red">435,10+/-11,42 293,92%+/-24,43%</td><td bgcolor="green">0,70+/-0,47 36,84%+/-42,43%</td><td bgcolor="green">50177,50+/-1,66 10,14%+/-0,00%</td></tr><tr><td>AES encrypted</td><td>0,40+/-0,50 109,09%+/-281,72%</td><td>134,47+/-8,19 94,58%+/-11,86%</td><td>56,83+/-4,43 147,36%+/-27,91%</td><td bgcolor="green">1,17+/-0,46 3,52%+/-2,53%</td><td bgcolor="red">24,53+/-3,10 1672,73%+/-928,81%</td><td>0,07+/-0,25 50,00%+/-319,94%</td><td bgcolor="red">433,37+/-15,28 292,75%+/-26,97%</td><td bgcolor="green">0,37+/-0,49 19,30%+/-35,17%</td><td>495811,97+/-0,18 100,21%+/-0,00%</td></tr><tr><td>AES CBC encrypted</td><td>0,33+/-0,48 90,91%+/-252,28%</td><td>136,30+/-8,09 95,87%+/-11,87%</td><td>57,33+/-4,72 148,66%+/-28,81%</td><td bgcolor="green">1,00+/-0,53 3,02%+/-2,56%</td><td bgcolor="red">22,67+/-2,87 1545,45%+/-858,19%</td><td bgcolor="green">0,03+/-0,18 25,00%+/-201,76%</td><td bgcolor="red">436,70+/-11,68 295,00%+/-24,67%</td><td bgcolor="green">0,60+/-0,56 31,58%+/-44,98%</td><td>496209,00+/-0,00 100,29%+/-0,00%</td></tr><tr><td>Compressed AES CBC encrypted</td><td>0,27+/-0,45 72,73%+/-219,88%</td><td>192,27+/-6,48 135,24%+/-13,28%</td><td bgcolor="red">204,33+/-9,36 529,82%+/-83,30%</td><td bgcolor="green">1,37+/-0,56 4,12%+/-3,01%</td><td bgcolor="red">22,03+/-2,51 1502,27%+/-815,34%</td><td>0,07+/-0,25 50,00%+/-319,94%</td><td bgcolor="red">437,50+/-13,68 295,54%+/-26,05%</td><td bgcolor="green">0,83+/-0,38 43,86%+/-41,25%</td><td bgcolor="green">50207,90+/-0,31 10,15%+/-0,00%</td></tr></table>