#summary Changes and performance on upgrade to Lucene 4.9
 
=  Lucene 4.9 changes =

Lucene 4.9 introduces big changes to Directory API, which simplifies implementation of transformation and ensures only sequential writes. Therefore no temporary files and copying is needed. For this reason file format has been changed and current implementation cannot read old files.  
 
= Detailed performance tests =


Chunk size 4k
<table border="1"><tr><th>Method</th><td>WriterOpen(ms)</td><td>Indexing(ms)</td><td>Optimization(ms)</td><td>Closing(ms)</td><td>ReaderOpen(ms)</td><td>Single search(ms)</td><td>Search(ms)</td><td>ReaderClose(ms)</td><td>Size(bytes)</td></tr><tr><td>lucene</td><td>0,30+/-0,47 100,00%+/-310,73%</td><td>157,03+/-13,93 100,00%+/-17,74%</td><td>84,77+/-9,19 100,00%+/-21,68%</td><td>35,50+/-7,73 100,00%+/-43,53%</td><td>3,13+/-0,86 100,00%+/-54,92%</td><td>0,13+/-0,35 100,00%+/-518,62%</td><td>2267,70+/-44,25 100,00%+/-3,90%</td><td>0,43+/-0,50 100,00%+/-232,62%</td><td>494780,00+/-0,00 100,00%+/-0,00%</td></tr><tr><td>lucene null</td><td>0,50+/-0,51 166,67%+/-428,46%</td><td>114,37+/-4,05 72,83%+/-9,04%</td><td>46,67+/-5,13 55,05%+/-12,03%</td><td bgcolor="green">1,47+/-0,51 4,13%+/-2,33%</td><td>3,77+/-0,73 120,21%+/-56,24%</td><td>0,07+/-0,25 50,00%+/-319,94%</td><td bgcolor="green">178,20+/-8,62 7,86%+/-0,53%</td><td bgcolor="red">1,73+/-0,69 400,00%+/-624,81%</td><td>497746,90+/-0,31 100,60%+/-0,00%</td></tr><tr><td>compressed</td><td>0,33+/-0,48 111,11%+/-332,45%</td><td>149,67+/-10,74 95,31%+/-15,29%</td><td>62,07+/-3,20 73,22%+/-11,72%</td><td bgcolor="green">1,60+/-0,56 4,51%+/-2,57%</td><td>3,87+/-0,68 123,40%+/-55,63%</td><td bgcolor="red">0,33+/-0,48 250,00%+/-1007,87%</td><td bgcolor="green">184,97+/-10,70 8,16%+/-0,63%</td><td bgcolor="red">1,17+/-0,53 269,23%+/-435,60%</td><td bgcolor="green">73095,47+/-1,55 14,77%+/-0,00%</td></tr><tr><td>AES encrypted</td><td>0,33+/-0,48 111,11%+/-332,45%</td><td>140,47+/-6,29 89,45%+/-11,94%</td><td>58,30+/-4,53 68,78%+/-12,80%</td><td bgcolor="green">1,27+/-0,58 3,57%+/-2,42%</td><td bgcolor="red">23,77+/-1,83 758,51%+/-266,75%</td><td>0,10+/-0,31 75,00%+/-423,33%</td><td bgcolor="green">178,03+/-7,70 7,85%+/-0,49%</td><td bgcolor="red">1,40+/-0,77 323,08%+/-553,49%</td><td>499930,00+/-0,00 101,04%+/-0,00%</td></tr><tr><td>AES CBC encrypted</td><td>0,33+/-0,48 111,11%+/-332,45%</td><td>145,03+/-6,95 92,36%+/-12,62%</td><td>59,43+/-6,37 70,11%+/-15,11%</td><td bgcolor="green">1,20+/-0,48 3,38%+/-2,10%</td><td bgcolor="red">24,30+/-1,34 775,53%+/-255,81%</td><td>0,13+/-0,35 100,00%+/-518,62%</td><td bgcolor="green">175,80+/-5,49 7,75%+/-0,39%</td><td bgcolor="red">1,27+/-0,74 292,31%+/-510,68%</td><td>500325,90+/-0,31 101,12%+/-0,00%</td></tr><tr><td>Compressed AES CBC encrypted</td><td>0,37+/-0,49 122,22%+/-353,27%</td><td>176,10+/-8,07 112,14%+/-15,08%</td><td>87,93+/-6,52 103,74%+/-18,94%</td><td bgcolor="green">1,43+/-0,57 4,04%+/-2,48%</td><td bgcolor="red">23,77+/-4,16 758,51%+/-340,98%</td><td>0,20+/-0,41 150,00%+/-694,09%</td><td bgcolor="green">180,30+/-7,14 7,95%+/-0,47%</td><td bgcolor="red">1,10+/-0,84 253,85%+/-490,21%</td><td bgcolor="green">74639,00+/-0,00 15,09%+/-0,00%</td></tr></table>
Chunk size 16k 
<table border="1"><tr><th>Method</th><td>WriterOpen(ms)</td><td>Indexing(ms)</td><td>Optimization(ms)</td><td>Closing(ms)</td><td>ReaderOpen(ms)</td><td>Single search(ms)</td><td>Search(ms)</td><td>ReaderClose(ms)</td><td>Size(bytes)</td></tr><tr><td>lucene</td><td>0,30+/-0,47 100,00%+/-310,73%</td><td>151,20+/-8,57 100,00%+/-11,34%</td><td>81,57+/-5,76 100,00%+/-14,12%</td><td>35,53+/-10,22 100,00%+/-57,51%</td><td>2,67+/-0,61 100,00%+/-45,49%</td><td>0,07+/-0,25 100,00%+/-761,12%</td><td>2281,33+/-26,67 100,00%+/-2,34%</td><td>0,40+/-0,50 100,00%+/-249,14%</td><td>494780,00+/-0,00 100,00%+/-0,00%</td></tr><tr><td>lucene null</td><td>0,57+/-0,50 188,89%+/-461,47%</td><td>113,03+/-3,48 74,76%+/-6,54%</td><td>45,03+/-3,36 55,21%+/-8,01%</td><td bgcolor="green">1,13+/-0,35 3,19%+/-1,89%</td><td>3,47+/-0,51 130,00%+/-48,59%</td><td bgcolor="red">0,30+/-0,47 450,00%+/-2411,67%</td><td bgcolor="green">226,33+/-7,46 9,92%+/-0,44%</td><td bgcolor="red">1,00+/-0,53 250,00%+/-442,73%</td><td>496046,90+/-0,31 100,26%+/-0,00%</td></tr><tr><td>compressed</td><td>0,27+/-0,45 88,89%+/-288,03%</td><td>141,03+/-7,46 93,28%+/-10,22%</td><td>58,30+/-3,99 71,48%+/-9,94%</td><td bgcolor="green">1,50+/-0,51 4,22%+/-2,65%</td><td>4,03+/-0,72 151,25%+/-61,34%</td><td bgcolor="red">0,43+/-0,50 650,00%+/-3229,66%</td><td bgcolor="green">224,17+/-8,45 9,83%+/-0,49%</td><td bgcolor="red">0,93+/-0,58 233,33%+/-436,48%</td><td bgcolor="green">56819,70+/-1,32 11,48%+/-0,00%</td></tr><tr><td>AES encrypted</td><td>0,33+/-0,48 111,11%+/-332,45%</td><td>137,63+/-5,34 91,03%+/-8,69%</td><td>57,93+/-5,42 71,03%+/-11,66%</td><td bgcolor="green">0,97+/-0,61 2,72%+/-2,51%</td><td bgcolor="red">23,70+/-2,47 888,75%+/-294,59%</td><td bgcolor="red">0,23+/-0,43 350,00%+/-1977,24%</td><td bgcolor="green">221,77+/-8,41 9,72%+/-0,48%</td><td bgcolor="red">0,87+/-0,51 216,67%+/-396,75%</td><td>496778,00+/-0,00 100,40%+/-0,00%</td></tr><tr><td>AES CBC encrypted</td><td>0,17+/-0,38 55,56%+/-212,66%</td><td>138,87+/-4,93 91,84%+/-8,47%</td><td>56,40+/-3,16 69,15%+/-8,75%</td><td bgcolor="green">1,07+/-0,45 3,00%+/-2,13%</td><td bgcolor="red">22,87+/-2,64 857,50%+/-293,86%</td><td bgcolor="red">0,23+/-0,43 350,00%+/-1977,24%</td><td bgcolor="green">224,13+/-9,63 9,82%+/-0,54%</td><td>0,73+/-0,52 183,33%+/-358,58%</td><td>497175,83+/-0,38 100,48%+/-0,00%</td></tr><tr><td>Compressed AES CBC encrypted</td><td>0,43+/-0,50 144,44%+/-392,42%</td><td>171,10+/-5,92 113,16%+/-10,33%</td><td>121,77+/-3,46 149,28%+/-14,78%</td><td bgcolor="green">1,37+/-0,61 3,85%+/-2,84%</td><td bgcolor="red">23,93+/-2,21 897,50%+/-287,06%</td><td>0,13+/-0,35 200,00%+/-1279,74%</td><td bgcolor="green">224,80+/-5,99 9,85%+/-0,38%</td><td>0,73+/-0,58 183,33%+/-374,20%</td><td bgcolor="green">57325,00+/-0,00 11,59%+/-0,00%</td></tr></table>
Chunk size 128k 
<table border="1"><tr><th>Method</th><td>WriterOpen(ms)</td><td>Indexing(ms)</td><td>Optimization(ms)</td><td>Closing(ms)</td><td>ReaderOpen(ms)</td><td>Single search(ms)</td><td>Search(ms)</td><td>ReaderClose(ms)</td><td>Size(bytes)</td></tr><tr><td>lucene</td><td>0,53+/-0,51 100,00%+/-190,28%</td><td>153,53+/-5,46 100,00%+/-7,12%</td><td>78,10+/-5,48 100,00%+/-14,03%</td><td>35,50+/-6,03 100,00%+/-33,96%</td><td>2,87+/-0,35 100,00%+/-24,12%</td><td>0,10+/-0,31 100,00%+/-610,26%</td><td>2273,53+/-48,89 100,00%+/-4,30%</td><td>0,27+/-0,45 100,00%+/-337,33%</td><td>494780,00+/-0,00 100,00%+/-0,00%</td></tr><tr><td>lucene null</td><td>0,40+/-0,50 75,00%+/-164,78%</td><td>115,30+/-4,94 75,10%+/-5,89%</td><td>45,23+/-4,54 57,92%+/-9,87%</td><td bgcolor="green">1,30+/-0,47 3,66%+/-1,93%</td><td>4,47+/-0,73 155,81%+/-44,27%</td><td>0,10+/-0,31 100,00%+/-610,26%</td><td bgcolor="green">432,13+/-13,47 19,01%+/-1,00%</td><td bgcolor="red">0,60+/-0,50 225,00%+/-566,35%</td><td>495482,00+/-0,00 100,14%+/-0,00%</td></tr><tr><td>compressed</td><td>0,37+/-0,49 68,75%+/-157,31%</td><td>141,43+/-3,97 92,12%+/-5,86%</td><td>60,33+/-3,40 77,25%+/-9,77%</td><td bgcolor="green">1,40+/-0,50 3,94%+/-2,07%</td><td bgcolor="red">6,83+/-0,46 238,37%+/-44,84%</td><td bgcolor="green">0,03+/-0,18 33,33%+/-284,28%</td><td bgcolor="green">432,47+/-9,07 19,02%+/-0,81%</td><td bgcolor="red">0,63+/-0,49 237,50%+/-584,38%</td><td bgcolor="green">50177,43+/-1,28 10,14%+/-0,00%</td></tr><tr><td>AES encrypted</td><td>0,30+/-0,47 56,25%+/-140,91%</td><td>140,70+/-5,40 91,64%+/-6,78%</td><td>58,67+/-3,45 75,12%+/-9,68%</td><td bgcolor="green">1,27+/-0,58 3,57%+/-2,25%</td><td bgcolor="red">24,73+/-2,20 862,79%+/-180,67%</td><td>0,10+/-0,31 100,00%+/-610,26%</td><td bgcolor="green">428,03+/-9,22 18,83%+/-0,81%</td><td>0,43+/-0,50 162,50%+/-463,09%</td><td>495811,97+/-0,18 100,21%+/-0,00%</td></tr><tr><td>AES CBC encrypted</td><td>0,37+/-0,49 68,75%+/-157,31%</td><td>136,50+/-4,80 88,91%+/-6,29%</td><td>62,07+/-6,76 79,47%+/-14,23%</td><td bgcolor="green">1,30+/-0,60 3,66%+/-2,30%</td><td bgcolor="red">24,07+/-2,32 839,53%+/-182,13%</td><td>0,20+/-0,41 200,00%+/-1017,10%</td><td bgcolor="green">429,03+/-7,75 18,87%+/-0,75%</td><td>0,43+/-0,50 162,50%+/-463,09%</td><td>496208,97+/-0,18 100,29%+/-0,00%</td></tr><tr><td>Compressed AES CBC encrypted</td><td bgcolor="green">0,23+/-0,43 43,75%+/-122,28%</td><td>193,47+/-5,12 126,01%+/-7,82%</td><td bgcolor="red">201,20+/-2,89 257,62%+/-21,78%</td><td bgcolor="green">1,33+/-0,55 3,76%+/-2,18%</td><td bgcolor="red">25,10+/-3,58 875,58%+/-230,66%</td><td bgcolor="green">0,00+/-0,00 0,00%+/-NaN%</td><td bgcolor="green">432,30+/-10,66 19,01%+/-0,88%</td><td bgcolor="red">0,60+/-0,50 225,00%+/-566,35%</td><td bgcolor="green">50207,90+/-0,31 10,15%+/-0,00%</td></tr></table>